{% extends "base.html" %}
{% block content %}
<div class="container ng-cloak" ng-app="mandisApp" ng-controller="mandisCtrl">

  <div class="row">
    <div class="col-md-12">
      <div class="alert alert-{[ message[0] ]} alert-dismissible"
           role="alert" ng-repeat="message in messages">
        <button type="button" class="close" data-dismiss="alert"
                aria-label="Close"><span aria-hidden="true">&times;</span></button>
        {[ message[1] ]}
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Věta</h3>
        </div>
        <div class="panel-body">
          <code><span ng-repeat="pos in utt">{[ pos.word ]} </span></code>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-8">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">Desambiguace</h3>
        </div>
        <div class="panel-body">
          <table class="table table-condensed">
            <thead>
              <tr>
                <th>word</th>
                <th>lemma</th>
                <th>tag</th>
                <th>označit</th>
                <th>poznámka</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-class="{highlight: pos.flag}"
                  ng-repeat="pos in utt">

                <!-- word column -->
                <td>{[ pos.word ]}</td>

                <!-- lemma column -->
                <td ng-if="numOfKeys(pos.pool) > 1">
                  <select ng-model="pos.lemma"
                          ng-options="lemma as lemma for (lemma, tags) in pos.pool">
                  </select>
                </td>
                <td ng-if="numOfKeys(pos.pool) == 1">
                  {[ pos.lemma = firstKey(pos.pool); pos.lemma ]}
                </td>
                <td ng-if="!pos.pool">
                  {[ pos.lemma ]}
                </td>

                <!-- tag column -->
                <td ng-if="pos.pool[pos.lemma].length > 1">
                  <select ng-model="pos.tag"
                          ng-change="$parent.$parent.helpTag = pos.tag"
                          ng-options="tag as tag for tag in pos.pool[pos.lemma]">
                  </select>
                </td>
                <td ng-if="pos.pool[pos.lemma].length == 1">
                  {[ pos.tag = pos.pool[pos.lemma][0]; pos.tag ]}
                </td>
                <td ng-if="!pos.pool">
                  {[ pos.tag ]}
                </td>
                <td ng-if="!pos.lemma">
                  <em>&mdash; vyberte nejprve lemma &mdash;</em>
                </td>

                <!-- flag column -->
                <td>
                  <input type="checkbox" ng-model="pos.flag">
                </td>

                <!-- comment column -->
                <td>
                  <textarea ng-if="pos.flag" ng-model="pos.note"></textarea>
                </td>
              </tr>
            </tbody>
          </table>
          <button ng-click="submitUtt(0)" type="button"
                  class="btn btn-primary">Uložit + nový segment</button>
          <button ng-click="submitUtt(1)" type="button"
                  class="btn btn-primary">Uložit + již hodnocený segment</button>
        </div>
      </div>
    </div>

    <div class="col-md-4" ng-show="helpTag">
      <div class="panel panel-success">
        <div class="panel-heading">
          <h3 class="panel-title">Nápověda k tagu {[ helpTag ]}</h3>
        </div>
        <div class="panel-body">
          <table class="table table-condensed table-striped">
            <tr ng-repeat="(idx, pos) in postag">
              <td><b>{[ pos.label ]}</b></td>
              <td><code>{[ helpTag[idx] ]}</code></td>
              <td>{[ pos[helpTag[idx]] ]}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>

  </div>

  {% if config.DEBUG %}
  <pre>
  {[ utt | json ]}
  </pre>
  {% endif %}

</div>
{% endblock %}
